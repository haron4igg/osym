//
//  main.c
//  osym_test
//
//  Created by Igor Reshetnikov on 15.05.13.
//  Copyright (c) 2013 World Evil Inc. All rights reserved.
//

#include <stdio.h>
#include "../Sources/calculator.h"
#include <stdlib.h>
#include <sys/time.h>

void outputed(double iteration, double* input, double step) {
    //printf(@"Output: %f", iteration);
}

void done(double* point, double iteration) {
    printf("Done (%f): [%f", iteration, point[0]);
    int i;
    for (i = 1; i < 18; i++) {
        printf(",%f", point[i]);
    }
    printf("]\n");

    /*
    double test[18] = {0.569152,-0.427253,0.202616,-0.821928,0.837494,-1.020645,-1.321102,1.231301,-1.337215,0.066170,-0.145651,0.261322,-0.379187,0.385180,-0.309460,-0.540714,0.463350,-0.545293};

    for (i = 0; i < 18; i ++) {
        if (test[i] != point[i]) {
            printf("Failure.\n");
        }
    }
    printf("Success.\n");
     */
}

unsigned long long currentTimeInMills() {
    struct timeval startTime;
    gettimeofday(&startTime, NULL);
    return (startTime.tv_sec * 1000 + (startTime.tv_usec / 1000));
}


int main(int argc, const char * argv[])
{


    double coefs[18 * 13] =
        {   0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.07407407407407407, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.027777777777777776, 0.08333333333333333, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.041666666666666664, 0.0, 0.125, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.4166666666666667, 0.0, -1.5625, 1.5625, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.05, 0.0, 0.0, 0.25, 0.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           -0.23148148148148148, 0.0, 0.0, 1.1574074074074074, -2.4074074074074074, 2.314814814814815, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.10333333333333333, 0.0, 0.0, 0.0, 0.27111111111111114, -0.2222222222222222, 0.014444444444444444, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           2.0, 0.0, 0.0, -8.833333333333334, 15.644444444444444, -11.88888888888889, 0.7444444444444445, 3.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           -0.8425925925925926, 0.0, 0.0, 0.21296296296296297, -7.229629629629629, 5.7592592592592595, -0.31666666666666665, 2.8333333333333335, -0.08333333333333333, 0.0, 0.0, 0.0, 0.0,
           0.5812195121951219, 0.0, 0.0, -2.0792682926829267, 4.3863414634146345, -3.6707317073170733, 0.5202439024390244, 0.5487804878048781, 0.27439024390243905, 0.43902439024390244, 0.0, 0.0, 0.0,
           0.014634146341463415, 0.0, 0.0, 0.0, 0.0, -0.14634146341463414, -0.014634146341463415, -0.07317073170731707, 0.07317073170731707, 0.14634146341463414, 0.0, 0.0, 0.0,
          -0.43341463414634146, 0.0, 0.0, -2.0792682926829267, 4.3863414634146345, -3.524390243902439, 0.5348780487804878, 0.6219512195121951, 0.20121951219512196, 0.2926829268292683, 0.0, 1.0, 0.0,
           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
    };



    double coefs2[18] = {0.04880952380952381, 0.0, 0.0, 0.0, 0.0, 0.3238095238095238, 0.2571428571428571, 0.2571428571428571, 0.03214285714285714, 0.03214285714285714, 0.0, 0.0, 0.04880952380952381, 0.0, 0.0, 0.0, 0.0, 0.0};

    double input[18] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.5446230076646713, 0.257800690054833, 0.25436137854197866, 0.2461605091991794, -0.3193534630602443, 0.628712774525114, 0.5874934622379206, -0.5699922058548407, 0.5867911096969345};

    double from = 0.0;
    double total = 10.0;
    double step = 1.0E-4;

    int paused = 0;
    int canceled = 0;

    printf("Hello, World!\n");


    unsigned long long startTime = currentTimeInMills();

    run(coefs, 13, coefs2, input, 18, from, total, step, &paused, &canceled, outputed, done);

    printf("Complete! \n msec: %lld", currentTimeInMills() - startTime);
    return 0;
}

